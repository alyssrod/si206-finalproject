import matplotlib.pyplot as plt
import sqlite3
from matplotlib import cm

def get_popularity_scores(cur):
    cur.execute("SELECT popularity FROM spotify_data")
    popularity_scores = cur.fetchall()
    return popularity_scores

def plot_popularity_histogram(data):
    plt.figure(figsize=(10, 6))

    # Flatten the list of popularity scores
    flattened_data = [item for sublist in data for item in sublist]

    n, bins, patches = plt.hist(flattened_data, bins=20, color=cm.plasma_r((flattened_data - min(flattened_data)) / (max(flattened_data) - min(flattened_data))), edgecolor='black')

    plt.xlabel('Popularity Score')
    plt.ylabel('Frequency')
    plt.title('Distribution of Song Popularity Scores')
    plt.grid(axis='y', alpha=0.75)
    plt.colorbar(patches)

    plt.tight_layout()
    plt.show()

conn = sqlite3.connect('final-database.db')
cur = conn.cursor()

popularity_scores_data = get_popularity_scores(cur)

plot_popularity_histogram(popularity_scores_data)

conn.close()
